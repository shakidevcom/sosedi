L.Control.Window=L.Control.extend({includes:L.Evented.prototype||L.Mixin.Events,options:{element:"map",className:"control-window",visible:!1,title:void 0,closeButton:!0,content:void 0,prompt:void 0,maxWidth:600,modal:!1,position:"center"},initialize:function(t,i){t.hasOwnProperty("options")&&(t=t.getContainer()),i.element=t,L.setOptions(this,i);var o="nonmodal";this.options.modal&&(o="modal"),this._wrapper=L.DomUtil.create("div",o+" leaflet-control-window-wrapper",L.DomUtil.get(this.options.element)),this._container=L.DomUtil.create("div","leaflet-control leaflet-control-window "+this.options.className,this._wrapper),this._container.setAttribute("style","max-width:"+this.options.maxWidth+"px"),this._containerTitleBar=L.DomUtil.create("div","titlebar",this._container),this.titleContent=L.DomUtil.create("h2","title",this._containerTitleBar),this._containerContent=L.DomUtil.create("div","content",this._container),this._containerPromptButtons=L.DomUtil.create("div","promptButtons",this._container),this.options.closeButton&&(this._closeButton=L.DomUtil.create("a","close",this._containerTitleBar),this._closeButton.innerHTML="&times;");var n=L.DomEvent.stopPropagation;if(L.DomEvent.on(this._wrapper,"contextmenu",n).on(this._wrapper,"click",n).on(this._wrapper,"mousedown",n).on(this._wrapper,"touchstart",n).on(this._wrapper,"dblclick",n).on(this._wrapper,"mousewheel",n).on(this._wrapper,"MozMousePixelScroll",n),this.options.closeButton){var e=this._closeButton;L.DomEvent.on(e,"click",this.hide,this)}this.options.title&&this.title(this.options.title),this.options.content&&this.content(this.options.content),"object"==typeof this.options.prompt&&this.prompt(this.options.prompt),this.options.visible&&this.show()},disableBtn:function(){this._btnOK.disabled=!0,this._btnOK.className="disabled"},enableBtn:function(){this._btnOK.disabled=!1,this._btnOK.className=""},title:function(t){if(null==t)return this.options.title;this.options.title=t;var i=t||"";return this.titleContent.innerHTML=i,this},remove:function(){L.DomUtil.get(this.options.element).removeChild(this._wrapper);var t=L.DomEvent.stopPropagation;if(L.DomEvent.off(this._wrapper,"contextmenu",t).off(this._wrapper,"click",t).off(this._wrapper,"mousedown",t).off(this._wrapper,"touchstart",t).off(this._wrapper,"dblclick",t).off(this._wrapper,"mousewheel",t).off(this._wrapper,"MozMousePixelScroll",t),this._closeButton&&this._close){var i=this._closeButton;L.DomEvent.off(i,"click",this.close,this)}return this},mapResized:function(){},show:function(t){t&&(this.options.position=t),L.DomUtil.addClass(this._wrapper,"visible"),this.setContentMaxHeight();var i=this._container.offsetWidth,o=this._container.offsetHeight,n=L.DomUtil.get(this.options.element).getBoundingClientRect(),e=n.right-n.left||Math.max(document.documentElement.clientWidth,window.innerWidth||0),s=n.bottom-n.top||Math.max(document.documentElement.clientHeight,window.innerHeight||0),h=n.top,r=n.left;return"topLeft"==this.options.position?this.showOn([r,h+0]):"left"==this.options.position?this.showOn([r,h+s/2-o/2-8+0]):"bottomLeft"==this.options.position?this.showOn([r,h+s-o-16-0]):"top"==this.options.position?this.showOn([r+e/2-i/2-8,h+0]):"topRight"==this.options.position?this.showOn([r+e-i-16,h+0]):"right"==this.options.position?this.showOn([r+e-i-16,h+s/2-o/2-8+0]):"bottomRight"==this.options.position?this.showOn([r+e-i-16,h+s-o-16-0]):"bottom"==this.options.position?this.showOn([r+e/2-i/2-8,h+s-o-16-0]):this.showOn([r+e/2-i/2-8,h+h+s/2-o/2-8+0]),this},showOn:function(t){return this.setContentMaxHeight(),L.DomUtil.setPosition(this._container,L.point(Math.round(t[0]),Math.round(t[1]),!0)),new L.Draggable(this._container,this._containerTitleBar).enable(),L.DomUtil.addClass(this._wrapper,"visible"),this.fire("show"),this},hide:function(t){return L.DomUtil.removeClass(this._wrapper,"visible"),this.fire("hide"),this},getContainer:function(){return this._containerContent},content:function(t){return null==t?this.options.content:(this.options.content=t,this.getContainer().innerHTML=t,this)},prompt:function(t){if(null==t)return this.options.prompt;this.options.prompt=t,this.setPromptCallback(t.callback),this.setActionCallback(t.action);var i=this.options.prompt.buttonCancel||void 0,o=this.options.prompt.buttonOK||"OK",n=this.options.prompt.buttonAction||void 0;if(null!=n){var e=L.DomUtil.create("button","",this._containerPromptButtons);L.DomEvent.on(e,"click",this.action,this),e.innerHTML=n}var s=L.DomUtil.create("button","",this._containerPromptButtons);if(L.DomEvent.on(s,"click",this.promptCallback,this),s.innerHTML=o,this._btnOK=s,null!=i){var h=L.DomUtil.create("button","",this._containerPromptButtons);L.DomEvent.on(h,"click",this.close,this),h.innerHTML=i}return this},container:function(t){return null==t?this._container.innerHTML:(this._container.innerHTML=t,this.options.closeButton&&(this._closeButton=L.DomUtil.create("a","close",this._container),this._closeButton.innerHTML="&times;",L.DomEvent.on(this._closeButton,"click",this.close,this)),this)},setPromptCallback:function(t){var i=this;"function"!=typeof t&&(t=function(){console.warn("No callback function specified!")});return this.promptCallback=function(){i.close(),t()},this},setActionCallback:function(t){var i=this;"function"!=typeof t&&(t=function(){console.warn("No callback function specified!")});return this.action=function(){i.hide(),t()},this},setContentMaxHeight:function(){var t=68;this.options.title&&(t+=this._containerTitleBar.offsetHeight-36),"object"==typeof this.options.prompt&&(t+=this._containerPromptButtons.offsetHeight-20);var i=L.DomUtil.get(this.options.element).getBoundingClientRect(),o=i.bottom-i.top-t;this._containerContent.setAttribute("style","max-height:"+o+"px")},close:function(){this.hide(),this.remove(),this.fire("close")}}),L.control.window=function(t,i){return new L.Control.Window(t,i)};